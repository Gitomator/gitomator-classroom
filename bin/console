#!/usr/bin/env ruby

require "bundler/setup"
require "classroom_automator"
require "trollop"


module ClassroomAutomator
  module Console

    @@context

    def self.context=(context)
      @@context=context
    end

    def classroom_automator_context
      @@context
    end

    def logger
      @@context.logger
    end

    def git
      @@context.git
    end

    def hosting
      @@context.hosting
    end

    def ci
      @@context.ci
    end

  end
end


opts = Trollop::options do
  version "Gitomator console 0.0.1 (c) 2016 Joey Freund"
  banner <<-EOS
IRB with convenient Gitomator functions pre-loaded.

Usage:
       console [options]
where [options] are:
EOS

  opt :context, "Context configuration file (default: ENV['CLASSROOM_AUTOMATOR_CONTEXT'])",
          :type => :string
end


if opts[:context] || ENV['CLASSROOM_AUTOMATOR_CONTEXT']
  require 'classroom_automator/workflow/context'
  ClassroomAutomator::Console.context =
    ClassroomAutomator::Workflow::Context.from_file(
      opts[:context] || ENV['CLASSROOM_AUTOMATOR_CONTEXT']
  )
  include ClassroomAutomator::Console
end

require "irb"
IRB.start
