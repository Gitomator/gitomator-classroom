#!/usr/bin/env ruby

require 'bundler/setup'

require 'classroom_automator/workflow/context'
require 'classroom_automator/config/assignment'

require 'classroom_automator/workflow/task/clone_handouts'

#===============================================================================

if ARGV.length != 3
  abort("Usage: #{File.basename($0)} CONTEXT-YAML ASSIGNMENT-YAML LOCAL-DIR")
end

begin

  context = ClassroomAutomator::Workflow::Context.from_file(ARGV[0])
  assignment_config  = ClassroomAutomator::Config::Assignment.from_file(ARGV[1])
  raise "LOCAL-DIR #{ARGV[2]} doesn't exist." unless Dir.exists? ARGV[2]
  local_dir = ARGV[2]

  ClassroomAutomator::Workflow::Task::CloneHandouts.new(
    context, assignment_config, local_dir
  ).run

rescue => e
  abort "#{e}.\n\nStack trace:\n#{e.backtrace.join('\n\t')}"
end
