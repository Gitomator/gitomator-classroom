#!/usr/bin/env ruby

require 'bundler/setup'
require 'classroom_automator/util'
require 'classroom_automator/workflow/task/clone_handouts'
require 'classroom_automator/workflow/context'
require 'classroom_automator/config/assignment'

#===============================================================================

usage_message = "Usage: #{File.basename($0)} ASSIGNMENT-CONF LOCAL-DIR"
opts = ClassroomAutomator::Util::CommandLine.parse_opts(usage_message)
if ARGV.length != 2
  abort(usage_message)
end


begin
  ClassroomAutomator::Workflow::Task::CloneHandouts.new(
    ClassroomAutomator::Workflow::Context.from_file(opts[:context]),
    ClassroomAutomator::Config::Assignment.from_file(ARGV[0]),
    ARGV[1]
  ).run
rescue => e
  abort "ERROR: #{e}.\n\n#{e.backtrace.join("\n\t")}"
end
